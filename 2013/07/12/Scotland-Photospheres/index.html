<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Andrew Bunday Photosphere's from around Scotland</title>    

    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.stellar.min.js"></script>
    <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
    <script type="text/javascript" src="/photo/css_browser_selector.js"></script>

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/pygments.css"/>
    <link rel="stylesheet" type="text/css" href="/fancybox/source/jquery.fancybox.css?v=2.1.5" media="screen" />  

    <link rel="alternate" type="application/rss+xml" title="RSS Feed for andrewbunday.co.uk" href="/rss.xml" />

    <link rel="stylesheet" type="text/css" href="/photo/boostrap.css"/>
    <link rel="stylesheet" type="text/css" href="/photo/photo.css"/>

</head>

    <body>

        <script type="text/javascript">
            $(window).stellar();

            $(document).ready(function () {
                // scale the banner to fit the window
                $('.photo').css({ "height": $(window).innerHeight() - 50,
                                  "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" 
                                });
                $('.photo-navbar').css({ "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" });
                $('.footer').css({ "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" });
            });

            $(document).ready(function () {
                // highlight the current pange
                $('a[href="' + this.location.pathname + '"]').addClass('activePage');
            });

            $(document).ready(function() {
                $(".fancybox").fancybox({
                                          helpers : {
                                            title: {
                                              type: 'outside'
                                            },
                                            overlay : {
                                              css : {
                                                'background' : 'rgba(46,46,46,0.8)',
                                              },
                                            },
                                          },
                                          padding: 0,
                                          closeBtn: false,
                                          arrows: false,
                                          nextClick: true,
                                          openEffect: 'elastic',
                                          openSpeed: 500
                                        });
            });
        </script>

        <div class="navbar transparent navbar-static-top photo-navbar">
            <div class="navbar-inner transparent main-navbar-inner">
                <div class="pull-right">
                    <ul class="nav transparent">
                        <!-- <li><a href="/new/">New</a></li> -->
                        <li><a href="/">Home</a></li>
                        <li><a href="/about/">About</a></li>
                        <li><a href="/posts/">Posts</a></li>
                        <li><a href="https://github.com/andrewbunday" target="_blank">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/andrewbunday" target="_blank">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid main-content">

            <div class="row-fluid" style="margin-top:-20px;">
                <div id="photo-banner" class="container photo" data-stellar-background-ratio="0.5" style="padding-top: 80px">

                    <div class="container">
                        <div class="row-fluid">
                            <div class="span6">Scotland</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">Photospheres</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">---</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">From around Scotland</div>
                        </div>
                    </div>  

                </div>

                <div class="container" style="padding-top:20px">
                    <h1>Photosphere's from around Scotland</h1>
                    <div class="row-fluid" style="margin-bottom:10px">
                        <div class="span8">
                            <p class="muted">Fri 12 Jul 2013</p>
                        </div>
                    </div>
                    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

<div id="viewerContainer" />

<h3 id="other-photospheres-in-the-set">Other photospheres in the set:</h3>
<div id="thumbnailContainer" />

<script>
  var FEED_SCHEMA = 'http://schemas.google.com/g/2005#feed';

  // Fetch all albums for a given user. Parameter 'user' should either be
  // the email address or user ID.
  function fetchAlbumsFor(user, searchForPanos) {
    $('#getAllPanos').attr('disabled', '');
    $('#thumbnailContainer').empty();

    var baseURL = 'https://picasaweb.google.com/data/feed/api/user/';        
    var url = baseURL + user + '?v=4&alt=json';
    $.getJSON(url, function(response) {
      if (!response || !response.feed || !response.feed.entry) {
        alert('Data invalid.');
        return;
      }

      // Remove all previous dropdown elements.
      $('#albumSelect').empty();

      // Add albums to dropdown element.
      $('#albumSelect').append($('<option></option>')
                       .attr('value', '')
                       .text('<Select an album>'));
      $.each(response.feed.entry, function(index, entry) {
        var feedUrl = getFeedUrl(entry);
        $('#albumSelect').append($('<option></option>')
                         .attr('value', feedUrl)
                         .text(entry.title.$t));
        if (searchForPanos) {
          fetchPhotos(feedUrl, false);
        }
      });
      $('#getAllPanos').removeAttr('disabled');
    }).fail(function() {
      alert('Could not fetch data.');
    });
  }

  // Returns the feed URL of an entry.
  function getFeedUrl(entry) {
    for(var i = 0; i < entry.link.length; ++i) {
      if (entry.link[i].rel == FEED_SCHEMA) {
        return entry.link[i].href;
      }
    }
    return '';
  }

  // Returns whether the given entry is a photo sphere.
  function isPhotoSphere(entry) {
    if (!entry.gphoto$streamId) {
      return false;
    }

    var streamIds = entry.gphoto$streamId;
    for (var i = 0; i < streamIds.length; ++i) {
      if (streamIds[i].$t == "photosphere") {
        return true;
      }
    }
    return false;
  }

  // Fetches the feed data for a photo sphere based on the given feed URL
  // and displays the photo sphere given the returned metadata.
  function displayPhotoSphere(panoFeedUrl) {
    console.log(panoFeedUrl);
    $('#viewerContainer').empty();

    // Request the full exif of the photo sphere, which contains the
    // metadata we need to properly display it.
    $.getJSON(panoFeedUrl + '&full-exif=true', function(response) {
      if (!response || !response.feed || !response.feed.exif$tags) {
        return;
      }

      // Extract the required metadata.
      var exif = response.feed.exif$tags;
      $('#viewerContainer')
          .append($('<g:panoembed></g:panoembed>')
          .attr('imageurl',
                response.feed.media$group.media$content[0].url)
          .attr('fullsize',
                exif.exif$FullPanoWidthPixels.$t + ',' +
                exif.exif$FullPanoHeightPixels.$t)
          .attr('croppedsize',
                 exif.exif$CroppedAreaImageWidthPixels.$t + ',' +
                 exif.exif$CroppedAreaImageHeightPixels.$t)
          .attr('offset',
                 exif.exif$CroppedAreaLeftPixels.$t + ',' +
                 exif.exif$CroppedAreaTopPixels.$t)
          .attr('displaysize', '800,600')
      );

      // Searches the whole DOM tree for g:panoembed elements and
      // initializes them.
      gapi.panoembed.go();
    });
  }

  // Fetches photos, filters photo spheres and displays them.
  function fetchPhotos(url, removePrevious) {
    $.getJSON(url, function(response) {
      if (!response || !response.feed || !response.feed.entry) {
        return;
      }

      // Add the thumbnails to the container and hook up the click
      // listeners.
      if (removePrevious) {
        $('#thumbnailContainer').empty();
      }
      $.each(response.feed.entry, function(index, entry) {
        if (isPhotoSphere(entry)) {
          $('#thumbnailContainer')
              .append($('<img></img>')
              .attr('src', entry.media$group.media$thumbnail[1].url)
              .attr('panoFeedUrl', getFeedUrl(entry))
              .click(function() {
            displayPhotoSphere($(this).attr('panoFeedUrl'));
          }));
        }
      });
    });
  }

  // // Fetch JSON for user if the OK button is clicked or the user hits the
  // // enter key in the input field.
  // $('#submitUserEmail').click(function() {
  //   fetchAlbumsFor($('#userEmail').val(), false);
  // });
  // $('#userEmail').bind('keypress', function(e) {
  //   // Fetch if enter key was pressed.
  //   var code = (e.keyCode ? e.keyCode : e.which);
  //   if (code == 13) {
  //     fetchAlbumsFor($('#userEmail').val(), false);
  //   }
  // });

  // fetchAlbumsFor('andrew.bunday@gmail.com', false);

  var photoset_url = 'https://picasaweb.google.com/data/feed/api/user/113352345146665803058/albumid/5899440571351727121?alt=json&v=4';
  var photosphere_url = 'https://picasaweb.google.com/data/feed/api/user/113352345146665803058/albumid/5899440571351727121/photoid/5899440569799198994?alt=json&v=4&full-exif=true';
  fetchPhotos(photoset_url, false);
  displayPhotoSphere(photosphere_url);

  // // Fetch the photo spheres when the user selects an album.
  // $('#albumSelect').change(function() {
  //   console.log($('#albumSelect').val());
  //   fetchPhotos($('#albumSelect').val(), true);
  // });
  // $('#getAllPanos').click(function() {
  //   fetchAlbumsFor($('#userEmail').val(), true);
  // });
</script>


                </div>

            </div>

            <div class="container" style="padding-top:20px"> 
                <div style="padding: 20px 0 20px 0">
                    <div id="disqus_container" class="row-fluid">
    <div class="span12">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'dumbtechnotes'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div>
                </div>
            </div>

            <div class="container footer" data-stellar-background-ratio="0.5">
    <div class="row-fluid">
        <div class="span12 rights-reserved" style="text-align: center">
            &copy; 2014. All rights reserved. All comments are my own and not those of my employer.
        </div>
    </div>
</div>

        </div>
     </body>
</html>
