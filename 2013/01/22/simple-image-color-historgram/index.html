<!DOCTYPE html>
<html>
    <head>
        <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Andrew Bunday [Python <small>generating a simple overlay histogram for an image</small>]</title>

    <link rel="shortcut icon" href="/assets/img/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/cosmo.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/pygments.css"/>
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for andrewbunday.co.uk" href="/rss.xml" />

    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-772003-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

    </head>
    <body>
        <div class="page">
            <div class="navbar navbar-static-top">
    <div class="navbar-inner main-navbar-inner">
        <div class="container-fluid main-navbar">
            <a class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
           </a>

            <div class="nav-collapse pull-right">
                <ul class="nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/posts">Posts</a></li>
                    <li><a href="https://github.com/andrewbunday" target="_blank">Github</a></li>
                    <li><a href="http://www.linkedin.com/in/andrewbunday" target="_blank">LinkedIn</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

            <div class="container-fluid main-content">
    <div class="page-header row-fluid">
        <h1>Andrew Bunday <small>tech notes</small></h1>
    </div>
</div>

            <div class="container-fluid main-content">
  <div class="row-fluid" id="breadcrumb">
      <ul class="nav nav-pills">
        <li><a href="/">home</a></li>
        
        
          <li><a href="/posts">posts</a></li>
        
        
          <li class="active">
              <a href="#">python generating a simple overlay histogram for an image</a>
          </li>
        
      </ul>
  </div>
</div>


            <div class="container-fluid main-content">
                <div class="row-fluid">
                    <div class="span12 span12-tablet">
                        <div class="row-fluid">
                            <div class="span12">
                                <h1>Python <small>generating a simple overlay histogram for an image</small></h1>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span8">
                                <p class="muted">Tue 22 Jan 2013</p>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <p><ul class="nav nav-list well" id="markdown-toc">
  <li><a href="#backstory">Backstory</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#quick-explanation">Quick Explanation</a></li>
  <li><a href="#the-code">The Code</a></li>
</ul>

<h3 id="backstory">Backstory</h3>

<p>This little example came about following a request from a supervisor who was remembering the ‘old’ days of when they used to use Shake and how they used to have a little histogram overlay which they could apply over the top of their comp during tech checks to quickly see if there where were any illegal values or obvious clipping occurring.</p>

<p>Unfortunately Nuke doesn’t have anything out of the box which quite matches this behaviour, and whilst the histogram Node is lacking, it is not a big enough bug bear to cause anyone to really want to ever launch Shake again.</p>

<p><em>That is a minor lie, the 2D tracker definitely is still good enough when compared to the one in Nuke that we still catch Compositors firing it up for a quick track.</em></p>

<h3 id="example">Example</h3>

<p><img src="https://raw.github.com/andrewbunday/PyHistogram/master/reference/example.png" alt="" /></p>

<h3 id="quick-explanation">Quick Explanation</h3>

<p>So here’s whats happening:</p>

<ol>
  <li>PIL.Image is used to open the input image, in this case a jpg but other formats could be used, and the Image class replaced with a reader for your particular image. The only important feature of the reader class is that it must be capable of formatting the pixel data as an array compatible with pylab.array().</li>
  <li>Each of the channels is extracted from the image for separate manipulation.</li>
  <li>We start a new figure, this initialises pylab.</li>
  <li>For each channel we compute a histogram of the pixel values. These will be displayed, overlaid on the figure, but will not be scaled to fit nicely within the bounds of our reference image.</li>
  <li>We compute the scale to apply to the x/y axis by finding out the maximum number of samples for each channel (X) and the maximum value of each sample (Y).</li>
  <li>All of the image data is displayed, and we modify the labels and properties of the graph axis to improve their legibility. </li>
</ol>

<h3 id="the-code">The Code</h3>

<div class="highlight"><pre><code class="python"><span class="lineno"> 1</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="lineno"> 2</span> <span class="kn">import</span> <span class="nn">pylab</span>
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="n">file_path</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/../reference/aa_van_and_bike.jpg&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="lineno"> 6</span> <span class="n">ncolors</span> <span class="o">=</span> <span class="mi">255</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="n">im</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="n">blue</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">b</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">11</span> <span class="n">green</span> <span class="o">=</span> <span class="p">[</span> <span class="n">g</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">12</span> <span class="n">red</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">r</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="lineno">15</span> <span class="n">b_n</span><span class="p">,</span> <span class="n">b_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">16</span> <span class="n">g_n</span><span class="p">,</span> <span class="n">g_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">17</span> <span class="n">r_n</span><span class="p">,</span> <span class="n">r_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">18</span> 
<span class="lineno">19</span> <span class="n">max_samples</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">b_n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_n</span><span class="p">)])</span>
<span class="lineno">20</span> <span class="n">max_density</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">b_n</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">g_n</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">r_n</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="lineno">21</span> <span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">max_samples</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">max_density</span><span class="p">])</span>
<span class="lineno">22</span> 
<span class="lineno">23</span> <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
<span class="lineno">24</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="lineno">25</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="lineno">26</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="lineno">27</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Saturation (0-1)&#39;</span><span class="p">)</span>
<span class="lineno">28</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Density&#39;</span><span class="p">)</span>
<span class="lineno">29</span> 
<span class="lineno">30</span> <span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Color Density Analysis of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
<span class="lineno">31</span> <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</p>
                        </div>
                    </div>
                    <!-- <div class="span3 hidden-phone hidden-tablet">
                        <ul class="thumbnails pull-right hidden-800">
    <li class="span12">
        <div class="thumbnail avatar">
            <img src="/assets/img/avatar.jpg" alt>
            <h4>About Me</h4>
            <h5><a href="/about.html">Andrew Bunday</a></h5>
            <p>I'm a VFX technologist working London where I apply the majority of
                   my time solving problems related to Pipeline and Systems development.</p>
            <p>If you want to get in touch, please give me a shout via one of the
               links at the bottom of the page.</p>
        </a>
    </li>
</ul>

                    </div> -->
                </div>
                <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dumbtechnotes'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            </div>
            <hr>

<div class="page-header" style="text-align: center">
  <h4>&copy; 2012. All rights reserved <small>All comments are my own and not those of my employer.</small></h4>
</div>



        </div>
     </body>
</html>


