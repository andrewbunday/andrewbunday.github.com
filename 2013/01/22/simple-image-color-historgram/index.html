<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Andrew Bunday How to generate a simple overlay histogram for an image</title>    

    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.stellar.min.js"></script>
    <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
    <script type="text/javascript" src="/photo/css_browser_selector.js"></script>

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/pygments.css"/>
    <link rel="stylesheet" type="text/css" href="/fancybox/source/jquery.fancybox.css?v=2.1.5" media="screen" />  

    <link rel="alternate" type="application/rss+xml" title="RSS Feed for andrewbunday.co.uk" href="/rss.xml" />

    <link rel="stylesheet" type="text/css" href="/photo/boostrap.css"/>
    <link rel="stylesheet" type="text/css" href="/photo/photo.css"/>

</head>

    <body>

        <script type="text/javascript">
            $(window).stellar();

            $(document).ready(function () {
                // scale the banner to fit the window
                $('.photo').css({ "height": $(window).innerHeight() - 50,
                                  "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" 
                                });
                $('.photo-navbar').css({ "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" });
                $('.footer').css({ "background-image": "url(http://farm4.staticflickr.com/3461/3947835362_305ed69eee_o.jpg)" });
            });

            $(document).ready(function () {
                // highlight the current pange
                $('a[href="' + this.location.pathname + '"]').addClass('activePage');
            });

            $(document).ready(function() {
                $(".fancybox").fancybox({
                                          helpers : {
                                            title: {
                                              type: 'outside'
                                            },
                                            overlay : {
                                              css : {
                                                'background' : 'rgba(46,46,46,0.8)',
                                              },
                                            },
                                          },
                                          padding: 0,
                                          closeBtn: false,
                                          arrows: false,
                                          nextClick: true,
                                          openEffect: 'elastic',
                                          openSpeed: 500
                                        });
            });
        </script>

        <div class="navbar transparent navbar-static-top photo-navbar">
            <div class="navbar-inner transparent main-navbar-inner">
                <div class="pull-right">
                    <ul class="nav transparent">
                        <!-- <li><a href="/new/">New</a></li> -->
                        <li><a href="/">Home</a></li>
                        <li><a href="/about/">About</a></li>
                        <li><a href="/posts/">Posts</a></li>
                        <li><a href="https://github.com/andrewbunday" target="_blank">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/andrewbunday" target="_blank">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid main-content">

            <div class="row-fluid" style="margin-top:-20px;">
                <div id="photo-banner" class="container photo" data-stellar-background-ratio="0.5" style="padding-top: 80px">

                    <div class="container">
                        <div class="row-fluid">
                            <div class="span6">Python</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">Generating Histograms</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">---</div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">Using PIL and pylab</div>
                        </div>
                    </div>  

                </div>

                <div class="container" style="padding-top:20px">
                    <h1>How to generate a simple overlay histogram for an image</h1>
                    <div class="row-fluid" style="margin-bottom:10px">
                        <div class="span8">
                            <p class="muted">Tue 22 Jan 2013</p>
                        </div>
                    </div>
                    <ul class="nav nav-list well" id="markdown-toc">
  <li><a href="#backstory">Backstory</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#quick-explanation">Quick Explanation</a></li>
  <li><a href="#the-code">The Code</a></li>
</ul>

<h3 id="backstory">Backstory</h3>

<p>This little example came about following a request from a supervisor who was remembering the ‘old’ days of when they used to use Shake and how they used to have a little histogram overlay which they could apply over the top of their comp during tech checks to quickly see if there where were any illegal values or obvious clipping occurring.</p>

<p>Unfortunately Nuke doesn’t have anything out of the box which quite matches this behaviour, and whilst the histogram Node is lacking, it is not a big enough bug bear to cause anyone to really want to ever launch Shake again.</p>

<p><em>That is a minor lie, the 2D tracker definitely is still good enough when compared to the one in Nuke that we still catch Compositors firing it up for a quick track.</em></p>

<h3 id="example">Example</h3>

<p><img src="https://raw.github.com/andrewbunday/PyHistogram/master/reference/example.png" alt="" /></p>

<h3 id="quick-explanation">Quick Explanation</h3>

<p>So here’s whats happening:</p>

<ol>
  <li>PIL.Image is used to open the input image, in this case a jpg but other formats could be used, and the Image class replaced with a reader for your particular image. The only important feature of the reader class is that it must be capable of formatting the pixel data as an array compatible with pylab.array().</li>
  <li>Each of the channels is extracted from the image for separate manipulation.</li>
  <li>We start a new figure, this initialises pylab.</li>
  <li>For each channel we compute a histogram of the pixel values. These will be displayed, overlaid on the figure, but will not be scaled to fit nicely within the bounds of our reference image.</li>
  <li>We compute the scale to apply to the x/y axis by finding out the maximum number of samples for each channel (X) and the maximum value of each sample (Y).</li>
  <li>All of the image data is displayed, and we modify the labels and properties of the graph axis to improve their legibility. </li>
</ol>

<h3 id="the-code">The Code</h3>

<div class="highlight"><pre><code class="python"><span class="lineno"> 1</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="lineno"> 2</span> <span class="kn">import</span> <span class="nn">pylab</span>
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="n">file_path</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/../reference/aa_van_and_bike.jpg&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="lineno"> 6</span> <span class="n">ncolors</span> <span class="o">=</span> <span class="mi">255</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="n">im</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="n">blue</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">b</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">11</span> <span class="n">green</span> <span class="o">=</span> <span class="p">[</span> <span class="n">g</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">12</span> <span class="n">red</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">r</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">im</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">channel</span> <span class="p">]</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="lineno">15</span> <span class="n">b_n</span><span class="p">,</span> <span class="n">b_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">16</span> <span class="n">g_n</span><span class="p">,</span> <span class="n">g_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">17</span> <span class="n">r_n</span><span class="p">,</span> <span class="n">r_bins</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">ncolors</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">aa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="lineno">18</span> 
<span class="lineno">19</span> <span class="n">max_samples</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">b_n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_n</span><span class="p">)])</span>
<span class="lineno">20</span> <span class="n">max_density</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">b_n</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">g_n</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">r_n</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="lineno">21</span> <span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">max_samples</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">max_density</span><span class="p">])</span>
<span class="lineno">22</span> 
<span class="lineno">23</span> <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
<span class="lineno">24</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="lineno">25</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="lineno">26</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="lineno">27</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Saturation (0-1)&#39;</span><span class="p">)</span>
<span class="lineno">28</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Density&#39;</span><span class="p">)</span>
<span class="lineno">29</span> 
<span class="lineno">30</span> <span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Color Density Analysis of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
<span class="lineno">31</span> <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

                </div>

            </div>

            <div class="container" style="padding-top:20px"> 
                <div style="padding: 20px 0 20px 0">
                    <div id="disqus_container" class="row-fluid">
    <div class="span12">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'dumbtechnotes'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div>
                </div>
            </div>

            <div class="container footer" data-stellar-background-ratio="0.5">
    <div class="row-fluid">
        <div class="span12 rights-reserved" style="text-align: center">
            &copy; 2014. All rights reserved. All comments are my own and not those of my employer.
        </div>
    </div>
</div>

        </div>
     </body>
</html>
