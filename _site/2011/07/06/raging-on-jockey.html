<!DOCTYPE html>
<html>
    <head>
        <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Raging on Jockey / Andy Bunday</title>

    <link rel="shortcut icon" href="/assets/img/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/ubuntu.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css"/>
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for andrewbunday.co.uk" href="/rss.xml" />

    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-772003-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

    </head>
    <body>
        <div class="page">
            <div class="navbar navbar-static-top">
    <div class="navbar-inner main-navbar-inner">
        <div class="container-fluid main-navbar">
            <a class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
           </a>

            <div class="nav-collapse pull-right">
                <ul class="nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/posts.html">Posts</a></li>
                    <li><a href="https://github.com/andrewbunday" target="_blank">Github</a></li>
                    <li><a href="http://www.linkedin.com/in/andrewbunday" target="_blank">LinkedIn</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

            <div class="page-header">
  <h3>Andrew Bunday <small>tech notes</small></h3>
</div>

            <ul class="breadcrumb">
  <li><a href="/">home</a> <span class="divider">/</span></li>
  
    <li><a href="/posts.html">posts</a> <span class="divider">/</span></li>
  
  
    <li class="active">raging on jockey</li>
  
</ul>


            <div class="container-fluid main-content">
                <div class="row-fluid">
                    <div class="span9 span12-tablet">
                        <div class="row-fluid">
                            <div class="span12">
                                <h1>Raging on Jockey</h1>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span8">
                                <p class="muted">Wed 06 Jul 2011</p>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <p><p>Recently I&#8217;ve been raging out quite frequently against some of the technology
I&#8217;ve been having to come acquaintedÂ  with. In particular there is Puppet a
centralised configuration tools which we&#8217;ve been using to orchestrate our
automated deployment system in conjunction with apt-get and reprepro as our
backend package respository here at Baseblack.</p>

<p>However describing the system we&#8217;ve been building is the topic of another for
longer and more interesting post. Where I can cover some of the hurdles we&#8217;ve
encountered and how we&#8217;ve dealt with them, despite some of the frankly bizarre
behaviours which Puppet exhibits.</p>

<h3 id="bloatware">Bloatware</h3>

<p>No, instead I&#8217;m going to pick on <strong>jockey-text</strong>. Jockey-text is the command
script version of the gtk interface provided with Ubuntu for the last few
releases for installing hardware drivers attached to the system. Specifically
graphics card adaptors, printers and firmware updates are handled by jockey. To
cope with such a broad range of packages to install, kernel modules to enable
and devices to probe for Jockey has become something of a behemoth.</p>

<p>The jockey-text executable itself is quite short, mearly wrapping the jockey
python module. However the module&#8217;s source runs at close to 4 1/2K lines of
code. This 4500 lines is taken up by numerous; private nested functions, class
methods and dbus-functions which bloat Jockey massively beyond what should be
required of it.</p>

<h3 id="exit-codes">Exit Codes</h3>

<p>However none of this should have mattered to us. Instead jockey should be doing
its thing and leaving us to get on with what we&#8217;ve been working on. To get a
workstation net installed and completely configured without human interation.</p>

<p>Unfortunately despite its near 4.5K of code, there is very little good exception
handling or adherence with the rules of program exit codes. You see should it
not get to the end of its run, because for example the driver your asking to be
enabled, has already been. Then jockey will immediately exit with a value of 1.</p>

<p>That makes it pretty darned hard to use with any confidence.</p>

<h3 id="installing-a-graphics-driver">Installing a graphics driver</h3>

<p>In our the action we wanted jockey to do was enable the nvidia driver which
we&#8217;re apt-getting from the x-swat ubuntu ppa. Getting annoyed with jockey, and
not particularly wanting to have to fight with Puppet, I decided to have a dive
into the jockey source and see what its really doing.</p>

<p>Here I present an immensely cut down version of what it&#8217;s really doing (in our
edge case).</p>

<p>Pretty simple huh? I&#8217;m still undecided about how we&#8217;re going to go about
installing our nvidia drivers. Although I have the sneaking susupission that
we&#8217;ll probably be <em>apt-get installing</em> them ourselves and then calling <em>nvidia-
xconfig</em> to enable them before rebooting at the end of the installation.</p>
</p>
                        </div>
                    </div>
                    <div class="span3 hidden-phone hidden-tablet">
                        <ul class="thumbnails pull-right hidden-800">
    <li class="span12">
        <div class="thumbnail avatar">
            <img src="/assets/img/avatar.jpg" alt>
            <h4>About Me</h4>
            <h5><a href="/about.html">Andrew Bunday</a></h5>
            <p>I'm a VFX technologist working London where I apply the majority of
                   my time solving problems related to Pipeline and Systems development.</p>
            <p>If you want to get in touch, please give me a shout via one of the
               links at the bottom of the page.</p>
        </a>
    </li>
</ul>

                    </div>
                </div>
            </div>
            <div class="page-header">
  <h4>&copy; 2012. All rights reserved <small>All comments are my own and feel free to contact me via the links below.</small></h4>
</div>

<div class="row-fluid post-contact-thumbs">
    <div class="span4">
        <a href="https://twitter.com/itwat" target="_blank">
            <img src="/assets/img/twitter-bird-blue-on-white.png" alt="">
        </a>
    </div>
    <div class="span4">
        <a href="http://github.com/andrewbunday" target="_blank">
            <img src="/assets/img/octocat.png" alt="">
        </a>
    </div>
    <div class="span4">
        <a href="http://www.linkedin.com/in/andrewbunday" target="_blank">
            <img src="/assets/img/LinkedIn_Logo200x200.png" alt="">
        </a>
    </div>
</div>


        </div>
     </body>
</html>


